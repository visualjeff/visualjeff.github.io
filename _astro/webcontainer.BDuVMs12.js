import{i as Ie}from"./is-preview-message.ZaUdCj-5.js";import{a as f}from"./index.DgoachrA.js";const xe="https://stackblitz.com",U="code",N="error",ie="error_description",Oe="__wc_api_bc__",K="__wc_api_tokens__",J="__wc_api_verifier__",V="__wc_api_popup__";class ee{_bus=new EventTarget;listen(e){function t(s){e(s.data)}return this._bus.addEventListener("message",t),()=>this._bus.removeEventListener("message",t)}fireEvent(e){this._bus.dispatchEvent(new MessageEvent("message",{data:e}))}}const _e=new Error;_e.stack="";const we=new ee;class S{origin;refresh;access;expires;_revoked=new AbortController;constructor(e,t,s,n){this.origin=e,this.refresh=t,this.access=s,this.expires=n}async activate(e){if(this._revoked.signal.aborted)throw new Error("Token revoked");return this.expires<Date.now()&&!await this._fetchNewAccessToken()?!1:(this._sync(),this._startRefreshTokensLoop(e),!0)}async revoke(e,t){this._revoked.abort();try{if(!(await fetch(`${this.origin}/oauth/revoke`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({token:this.refresh,token_type_hint:"refresh_token",client_id:e}),mode:"cors"})).ok)throw new Error("Failed to logout")}catch(s){if(!t)throw s}B()}static fromStorage(){const e=We();return e?new S(e.origin,e.refresh,e.access,e.expires):null}static async fromAuthCode({editorOrigin:e,clientId:t,codeVerifier:s,authCode:n,redirectUri:i}){const o=await fetch(`${e}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:t,code:n,code_verifier:s,grant_type:"authorization_code",redirect_uri:i}),mode:"cors"});if(!o.ok)throw new Error(`Failed to fetch token: ${o.status}`);const a=await o.json();ae(a);const{access_token:l,refresh_token:c}=a,h=oe(a);return new S(e,c,l,h)}async _fetchNewAccessToken(){try{const e=await fetch(`${this.origin}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:this.refresh}),mode:"cors",signal:this._revoked.signal});if(!e.ok)throw _e;const t=await e.json();ae(t);const{access_token:s,refresh_token:n}=t,i=oe(t);return this.access=s,this.expires=i,this.refresh=n,!0}catch{return B(),!1}}_sync(){Me(this),Ne(this.access)}async _startRefreshTokensLoop(e){for(;;){const t=this.expires-Date.now()-1e3;if(await Ue(Math.max(t,1e3)),this._revoked.signal.aborted)return;if(!this._fetchNewAccessToken()){e();return}this._sync()}}}function B(){localStorage.removeItem(K)}function De(r){return we.listen(r)}function We(){const r=localStorage.getItem(K);if(!r)return null;try{return JSON.parse(r)}catch{return null}}function Me(r){localStorage.setItem(K,JSON.stringify(r))}function oe({created_at:r,expires_in:e}){return(r+e)*1e3}function ae(r){if(typeof r!="object"||!r)throw new Error("Invalid Token Response");if(typeof r.access_token!="string"||typeof r.refresh_token!="string"||typeof r.created_at!="number"||typeof r.expires_in!="number")throw new Error("Invalid Token Response")}function Ue(r){return new Promise(e=>setTimeout(e,r))}function Ne(r){we.fireEvent(r)}async function ze(r){const e=new TextEncoder().encode(r),t=new Uint8Array(await crypto.subtle.digest("SHA-256",e));return btoa(t.reduce((s,n)=>s+String.fromCodePoint(n),"")).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function $e(){const r=new Uint8Array(96);crypto.getRandomValues(r);let e="";for(let t=0;t<32;++t)e+=je(r[3*t+0],r[3*t+1],r[3*t+2]);return e}function je(r,e,t){const s=r>>2,n=(r&3)<<4|e>>4,i=e&15|(t&192)>>2,o=t&63;return[s,n,i,o].map(Je).join("")}function Je(r){let e;return r<26?e=r+65:r<52?e=r-26+97:r<62?e=r-52+48:e=r===62?30:45,String.fromCharCode(e)}function Ve(){let r,e;function t(){e=new Promise(s=>r=s)}return t(),{get promise(){return e},resolve(s){return r(s)},reset:t}}let R;const u={initialized:!1,forwardAuth:!0,redirectUri:"",authComplete:Ve(),clientId:"",oauthScope:"",broadcastChannel:null,get editorOrigin(){return R==null&&(R=new URL(globalThis.WEBCONTAINER_API_IFRAME_URL??xe).origin),R},set editorOrigin(r){R=r},tokens:null},ce=new ee,g=new ee;function E(r){u.broadcastChannel&&(u.broadcastChannel.postMessage(r),localStorage.getItem(V)==="true"&&r.type!=="auth-logout"&&(localStorage.removeItem(V),setTimeout(()=>{window.close()})))}const Be={init({editorOrigin:r,clientId:e,scope:t,forwardAuth:s,redirectUri:n}){if(u.initialized)throw new Error("Init should only be called once");if(u.initialized=!0,u.forwardAuth=s??!0,u.redirectUri=n??H(),r&&(u.editorOrigin=new URL(r).origin),u.tokens=S.fromStorage(),u.clientId=e,u.oauthScope=t,u.broadcastChannel=new BroadcastChannel(Oe),g.listen(()=>u.authComplete.reset()),u.broadcastChannel.addEventListener("message",async l=>{const c=l.data;if(c.type==="auth-complete"){u.tokens=S.fromStorage(),await u.tokens.activate(z),u.authComplete.resolve();return}if(c.type==="auth-failed"){ce.fireEvent(c);return}if(c.type==="auth-logout"){g.fireEvent();return}}),u.tokens){const l=u.tokens;if(l.origin===u.editorOrigin)return(async()=>{if(!await l.activate(z)){if(u.tokens!==l)return;g.fireEvent();return}u.authComplete.resolve()})(),{status:"authorized"};B(),u.tokens=null}const i=new URL(window.location.href),{searchParams:o}=i,a=()=>window.history.replaceState({},document.title,i);if(o.has(N)){const l=o.get(N),c=o.get(ie);return o.delete(N),o.delete(ie),a(),E({type:"auth-failed",error:l,description:c}),{status:"auth-failed",error:l,description:c}}if(o.has(U)){const l=o.get(U),c=u.editorOrigin;o.delete(U),a();const h=localStorage.getItem(J);if(!h)return{status:"need-auth"};localStorage.removeItem(J);let d=H();return S.fromAuthCode({editorOrigin:c,clientId:u.clientId,authCode:l,codeVerifier:h,redirectUri:d}).then(async p=>{if(u.tokens=p,ge(u.tokens),!await u.tokens.activate(z))throw new Error;u.authComplete.resolve(),E({type:"auth-complete"})}).catch(p=>{console.error(p),g.fireEvent(),E({type:"auth-logout"})}),{status:"authorized"}}return{status:"need-auth"}},async startAuthFlow({popup:r}={}){if(!u.initialized)throw new Error("auth.init must be called first");if(r){localStorage.setItem(V,"true");const e=500,t=620,s=window.screenLeft+(window.outerWidth-t)/2,n=window.screenTop+(window.outerHeight-e)/2;window.open(await le(),"_blank",`popup,width=${t},height=${e},left=${s},top=${n}`)}else window.location.href=await le()},async logout({ignoreRevokeError:r}={}){await u.tokens?.revoke(u.clientId,r??!1),g.fireEvent(),E({type:"auth-logout"})},loggedIn(){return u.authComplete.promise},on(r,e){switch(r){case"auth-failed":return ce.listen(e);case"logged-out":return g.listen(e);default:throw new Error(`Unsupported event type '${r}'.`)}}};function z(){g.fireEvent(),E({type:"auth-logout"})}function H(){return window.location.href}async function le(){const r=$e();localStorage.setItem(J,r);const e=await ze(r),t=new URL("/oauth/authorize",u.editorOrigin),{searchParams:s}=t;let n=H();return s.append("response_type","code"),s.append("client_id",u.clientId),s.append("redirect_uri",n),s.append("scope",u.oauthScope),s.append("code_challenge",e),s.append("code_challenge_method","S256"),t.toString()}function ge(r){if(!r)throw new Error("Oops! Tokens is not defined when it always should be.")}function ye(r){const e={d:{}};for(const t of Object.keys(r)){const s=r[t];if("file"in s){const i=s.file.contents,o=typeof i=="string"?i:He(i),a=typeof i=="string"?{}:{b:!0};e.d[t]={f:{c:o,...a}};continue}const n=ye(s.directory);e.d[t]=n}return e}function He(r){let e="";for(const t of r)e+=String.fromCharCode(t);return e}var qe=Object.defineProperty,Ge=(r,e)=>{for(var t in e)qe(r,t,{get:e[t],enumerable:!0})},_={};Ge(_,{createEndpoint:()=>be,expose:()=>se,proxy:()=>Fe,proxyMarker:()=>te,releaseProxy:()=>Ce,transfer:()=>Ee,transferHandlers:()=>re,windowEndpoint:()=>Ke,wrap:()=>ke});var te=Symbol("Comlink.proxy"),be=Symbol("Comlink.endpoint"),Ce=Symbol("Comlink.releaseProxy"),q=Symbol("Comlink.thrown"),ve=r=>typeof r=="object"&&r!==null||typeof r=="function",Ye={canHandle:r=>ve(r)&&r[te],serialize(r){const{port1:e,port2:t}=new MessageChannel;return se(r,e),[t,[t]]},deserialize(r){return r.start(),ke(r)}},Xe={canHandle:r=>ve(r)&&q in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},re=new Map([["proxy",Ye],["throw",Xe]]);function se(r,e=self){e.addEventListener("message",function t(s){if(!s||!s.data)return;const{id:n,type:i,path:o}=Object.assign({path:[]},s.data),a=(s.data.argumentList||[]).map(y);let l;try{const c=o.slice(0,-1).reduce((d,p)=>d[p],r),h=o.reduce((d,p)=>d[p],r);switch(i){case 0:l=h;break;case 1:c[o.slice(-1)[0]]=y(s.data.value),l=!0;break;case 2:l=h.apply(c,a);break;case 3:{const d=new h(...a);l=Fe(d)}break;case 4:{const{port1:d,port2:p}=new MessageChannel;se(r,p),l=Ee(d,[d])}break;case 5:l=void 0;break}}catch(c){l={value:c,[q]:0}}Promise.resolve(l).catch(c=>({value:c,[q]:0})).then(c=>{const[h,d]=ne(c);e.postMessage(Object.assign(Object.assign({},h),{id:n}),d),i===5&&(e.removeEventListener("message",t),Se(e))})}),e.start&&e.start()}function Qe(r){return r.constructor.name==="MessagePort"}function Se(r){Qe(r)&&r.close()}function ke(r,e){return G(r,[],e)}function A(r){if(r)throw new Error("Proxy has been released and is not useable")}function G(r,e=[],t=function(){}){let s=!1;const n=new Proxy(t,{get(i,o){if(A(s),o===Ce)return()=>v(r,{type:5,path:e.map(a=>a.toString())}).then(()=>{Se(r),s=!0});if(o==="then"){if(e.length===0)return{then:()=>n};const a=v(r,{type:0,path:e.map(l=>l.toString())}).then(y);return a.then.bind(a)}return G(r,[...e,o])},set(i,o,a){A(s);const[l,c]=ne(a);return v(r,{type:1,path:[...e,o].map(h=>h.toString()),value:l},c).then(y)},apply(i,o,a){A(s);const l=e[e.length-1];if(l===be)return v(r,{type:4}).then(y);if(l==="bind")return G(r,e.slice(0,-1));const[c,h]=ue(a);return v(r,{type:2,path:e.map(d=>d.toString()),argumentList:c},h).then(y)},construct(i,o){A(s);const[a,l]=ue(o);return v(r,{type:3,path:e.map(c=>c.toString()),argumentList:a},l).then(y)}});return n}function Ze(r){return Array.prototype.concat.apply([],r)}function ue(r){const e=r.map(ne);return[e.map(t=>t[0]),Ze(e.map(t=>t[1]))]}var Te=new WeakMap;function Ee(r,e){return Te.set(r,e),r}function Fe(r){return Object.assign(r,{[te]:!0})}function Ke(r,e=self,t="*"){return{postMessage:(s,n)=>r.postMessage(s,t,n),addEventListener:e.addEventListener.bind(e),removeEventListener:e.removeEventListener.bind(e)}}function ne(r){for(const[e,t]of re)if(t.canHandle(r)){const[s,n]=t.serialize(r);return[{type:3,name:e,value:s},n]}return[{type:0,value:r},Te.get(r)||[]]}function y(r){switch(r.type){case 3:return re.get(r.name).deserialize(r.value);case 0:return r.value}}function v(r,e,t){return new Promise(s=>{const n=et();r.addEventListener("message",function i(o){!o.data||!o.data.id||o.data.id!==n||(r.removeEventListener("message",i),s(o.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:n},e),t)})}function et(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const F=Be;let I=null,x=null,$={};const tt=new TextDecoder,rt=new TextEncoder;class C{_instance;_runtimeInfo;fs;static _instance=null;_tornDown=!1;_unsubscribeFromTokenChangedListener=()=>{};constructor(e,t,s){this._instance=e,this._runtimeInfo=s,this.fs=new ct(t),u.initialized&&!0&&(this._unsubscribeFromTokenChangedListener=De(i=>{this._instance.setCredentials({accessToken:i,editorOrigin:u.editorOrigin})}),(async()=>{await u.authComplete.promise,!this._tornDown&&(ge(u.tokens),await this._instance.setCredentials({accessToken:u.tokens.access,editorOrigin:u.editorOrigin}))})().catch(i=>{console.error(i)}))}async spawn(e,t,s){let n=[];Array.isArray(t)?n=t:s=t;let i,o=new ReadableStream;if(s?.output!==!1){const c=mt();i=c.push,o=c.stream}const a=Pe(ut(i)),l=await this._instance.run({command:e,args:n,cwd:s?.cwd,env:s?.env,terminal:s?.terminal},void 0,void 0,a);return new at(l,o)}on(e,t){if(e==="preview-message"){const i=t;t=o=>{Ie(o)&&i(o)}}const{listener:s,subscribe:n}=_t(t);return n(this._instance.on(e,_.proxy(s)))}mount(e,t){const s=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):rt.encode(JSON.stringify(ye(e)));return this._instance.loadFiles(_.transfer(s,[s.buffer]),{mountPoints:t?.mountPoint})}get path(){return this._runtimeInfo.path}get workdir(){return this._runtimeInfo.cwd}teardown(){if(this._tornDown)throw new Error("WebContainer already torn down");this._tornDown=!0,this._unsubscribeFromTokenChangedListener(),this.fs._teardown(),this._instance.teardown(),this._instance[_.releaseProxy](),C._instance===this&&(C._instance=null)}static async boot(e={}){const{workdirName:t}=e;if(window.crossOriginIsolated&&e.coep==="none"&&console.warn(`A Cross-Origin-Embedder-Policy header is required in cross origin isolated environments.
Set the 'coep' option to 'require-corp'.`),t?.includes("/")||t===".."||t===".")throw new Error("workdirName should be a valid folder name");for(;I;)await I;if(C._instance)throw new Error("Only a single WebContainer instance can be booted");const s=lt(e);I=s.catch(()=>{});try{const n=await s;return C._instance=n,n}finally{I=null}}}const st=1,nt=2;class it{name;_type;constructor(e,t){this.name=e,this._type=t}isFile(){return this._type===st}isDirectory(){return this._type===nt}}class ot{_apiClient;_path;_options;_listener;_wrappedListener;_watcher;_closed=!1;constructor(e,t,s,n){this._apiClient=e,this._path=t,this._options=s,this._listener=n,this._apiClient._watchers.add(this),this._wrappedListener=(i,o)=>{this._listener&&!this._closed&&this._listener(i,o)},this._apiClient._fs.watch(this._path,this._options,Pe(this._wrappedListener)).then(i=>{this._watcher=i,this._closed&&this._teardown()}).catch(console.error)}close(){this._closed||(this._closed=!0,this._apiClient._watchers.delete(this),this._teardown())}_teardown(){this._watcher?.close().finally(()=>{this._watcher?.[_.releaseProxy]()})}}class at{output;input;exit;_process;constructor(e,t){this.output=t,this._process=e,this.input=new WritableStream({write:s=>{this._getProcess()?.write(s).catch(()=>{})}}),this.exit=this._onExit()}kill(){this._getProcess()?.kill()}resize(e){this._getProcess()?.resize(e)}async _onExit(){try{return await this._process.onExit}finally{this._process?.[_.releaseProxy](),this._process=null}}_getProcess(){return this._process==null&&console.warn("This process already exited"),this._process}}class ct{_fs;_watchers=new Set([]);constructor(e){this._fs=e}rm(...e){return this._fs.rm(...e)}async readFile(e,t){return await this._fs.readFile(e,t)}async rename(e,t){return await this._fs.rename(e,t)}async writeFile(e,t,s){if(t instanceof Uint8Array){const n=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);t=_.transfer(new Uint8Array(n),[n])}await this._fs.writeFile(e,t,s)}async readdir(e,t){const s=await this._fs.readdir(e,t);return dt(s)||ft(s)?s:s.map(i=>new it(i.name,i["Symbol(type)"]))}async mkdir(e,t){return await this._fs.mkdir(e,t)}watch(e,t,s){return typeof t=="function"&&(s=t,t=null),new ot(this,e,t,s)}_teardown(){this._fs[_.releaseProxy]();for(const e of this._watchers)e.close()}}async function lt(r){const{serverPromise:e}=ht(r),s=await(await e).build({host:window.location.host,version:"1.2.4",workdirName:r.workdirName,forwardPreviewErrors:r.forwardPreviewErrors}),n=await s.fs(),i=await s.runtimeInfo();return new C(s,n,i)}function ut(r){if(r!=null)return e=>{e instanceof Uint8Array?r(tt.decode(e)):e==null&&r(null)}}function Pe(r){if(r!=null)return _.proxy(r)}function ht(r){if(x!=null)return r.coep!==$.coep&&(console.warn(`Attempting to boot WebContainer with 'coep: ${r.coep}'`),console.warn(`First boot had 'coep: ${$.coep}', new settings will not take effect!`)),{serverPromise:x};const e=document.createElement("iframe");e.style.display="none",e.setAttribute("allow","cross-origin-isolated");const t=pt();r.coep&&t.searchParams.set("coep",r.coep),e.src=t.toString();const{origin:s}=t;return $={...r},x=new Promise(n=>{const i=o=>{if(o.origin!==s)return;const{data:a}=o;if(a.type==="init"){n(_.wrap(o.ports[0]));return}if(a.type==="warning"){console[a.level].call(console,a.message);return}};window.addEventListener("message",i)}),document.body.insertBefore(e,null),{serverPromise:x}}function dt(r){return typeof r[0]=="string"}function ft(r){return r[0]instanceof Uint8Array}function pt(){const r=new URL(u.editorOrigin);return r.pathname="/headless",u.initialized&&r.searchParams.set("client_id",u.clientId),r.searchParams.set("version","1.2.4"),r}function mt(){let r=null;return{stream:new ReadableStream({start(s){r=s}}),push:s=>{s!=null?r?.enqueue(s):(r?.close(),r=null)}}}function _t(r){let e=!1,t=()=>{};return{subscribe(n){return n.then(i=>{t=i,e&&t()}),()=>{e=!0,t()}},listener:(...n)=>{e||r(...n)}}}const wt=5,O=6,D=10;let gt=(r,e,t,s)=>(r.events=r.events||{},r.events[t+D]||(r.events[t+D]=s(n=>{r.events[t].reduceRight((i,o)=>(o(i),i),{shared:{},...n})})),r.events[t]=r.events[t]||[],r.events[t].push(e),()=>{let n=r.events[t],i=n.indexOf(e);n.splice(i,1),n.length||(delete r.events[t],r.events[t+D](),delete r.events[t+D])}),yt=1e3,bt=(r,e)=>gt(r,s=>{let n=e(s);n&&r.events[O].push(n)},wt,s=>{let n=r.listen;r.listen=(...o)=>(!r.lc&&!r.active&&(r.active=!0,s()),n(...o));let i=r.off;return r.events[O]=[],r.off=()=>{i(),setTimeout(()=>{if(r.active&&!r.lc){r.active=!1;for(let o of r.events[O])o();r.events[O]=[]}},yt)},()=>{r.listen=n,r.off=i}}),Ct=(r,e,t)=>{Array.isArray(r)||(r=[r]);let s,n=0,i=()=>{let l=r.map(c=>c.get());if(s===void 0||l.some((c,h)=>c!==s[h])){let c=++n;s=l;let h=e(...l);h&&h.then&&h.t?h.then(d=>{c===n&&o.set(d)}):o.set(h)}},o=f(void 0,Math.max(...r.map(l=>l.l))+1),a=i;return bt(o,()=>{let l=r.map(c=>c.listen(a,-1/o.l));return i(),()=>{for(let c of l)c()}}),o},he=(r,e)=>Ct(r,e),vt=(r={})=>{let e=f(r);return e.setKey=function(t,s){let n=e.value;typeof s>"u"&&t in e.value?(e.value={...e.value},delete e.value[t],e.notify(n,t)):e.value[t]!==s&&(e.value={...e.value,[t]:s},e.notify(n,t))},e};const Le=!1;class Y{prepareCommands;mainCommand;constructor({prepareCommands:e,mainCommand:t}){this.prepareCommands=e?.map(s=>new k(s)),this.mainCommand=t?new k(t):void 0}[Symbol.iterator](){const e=this;return function*(){for(const t of e.prepareCommands??[])yield t;e.mainCommand&&(yield e.mainCommand)}()}}class k{shellCommand;title;constructor(e){this.shellCommand=k.toShellCommand(e),this.title=k.toTitle(e)}isRunnable(){return this.shellCommand!==""}static equals(e,t){return e.shellCommand===t.shellCommand}static toTitle(e){let t="";return typeof e=="string"?t=e:Array.isArray(e)?t=e[1]:t=e.title,t}static toShellCommand(e){return typeof e=="string"?e:Array.isArray(e)?e[0]:e.command}}function Re(){if(typeof Promise.withResolvers=="function")return Promise.withResolvers();let r,e;const t=new Promise((s,n)=>{r=s,e=n});return{resolve:r,reject:e,promise:t}}function St(r){return new Promise(e=>setTimeout(e,r))}function kt(){return new Promise(r=>{setTimeout(r)})}const b=f("unknown"),Ae=Re(),Tt=b;async function Et(r){b.get()==="unknown"&&b.set(Pt()?"blocked":"booting"),b.get()==="blocked"&&(await Ae.promise,b.set("booting"));const e=await C.boot(r);return b.set("booted"),e}function Ft(){b.get()==="blocked"&&Ae.resolve()}function Pt(){const{userAgent:r,maxTouchPoints:e,platform:t}=navigator,s=/iPhone/.test(r)||t==="iPhone",n=t==="MacIntel"&&e>1||t==="iPad";return s||n}class de{port;origin;ready;constructor(e,t,s=!1){this.port=e,this.origin=t,this.ready=s}}class W{portInfo;title;pathname;get url(){if(this.baseUrl)return new URL(this.pathname??"/",this.baseUrl).toString()}get port(){return this.portInfo.port}get baseUrl(){return this.portInfo.origin}get ready(){return this.portInfo.ready}constructor(e,t){this.title=e.title,this.pathname=e.pathname,this.portInfo=t}static parse(e){if(typeof e=="number")return{port:e};if(typeof e=="string"){const[t,...s]=e.split("/");return{port:parseInt(t),pathname:s.join("/")}}else return Array.isArray(e)?{port:e[0],title:e[1],pathname:e[2]}:e}static equals(e,t){return e.portInfo.port===t.portInfo.port&&e.pathname===t.pathname&&e.title===t.title}}class Lt{steps=f(void 0);setFromCommands(e){e.length>0?this.steps.set(e.map(t=>({title:t.title,status:"idle"}))):this.steps.set(void 0)}updateStep(e,t){const s=this.steps.value;s&&this.steps.set([...s.slice(0,e),t,...s.slice(e+1)])}skipRemaining(e){const t=this.steps.value;t&&this.steps.set([...t.slice(0,e),...t.slice(e).map(s=>({...s,status:"skipped"}))])}}const Rt=Symbol("kTaskCancelled");class j extends Error{}function w(r,e={}){const t=new AbortController,s=()=>t.abort(new j),n=e.signal;let i=r(t.signal);return n&&(i=i.finally(()=>n.removeEventListener("abort",s)),n.addEventListener("abort",s,{once:!0})),{promise:e.ignoreCancel?i.catch(o=>{if(!(o instanceof j))throw o;return Rt}):i,cancel(){t.abort(new j)}}}class At{_basePathname;_map=new Map;_templateLoadTask;_templateLoaded;constructor(e="/"){this._basePathname=e,this._basePathname.endsWith("/")||(this._basePathname=this._basePathname+"/")}async invalidate(e){if(!this._map.has(e))return{type:"none"};const t=It(e);let s;return this._templateLoaded===e?s=await this._fetchTemplate(e).promise:s=await this._fetchFiles(e),{type:t,files:s}}async getLessonTemplate(e){const t=`template-${e.data.template}.json`;return this._map.has(t)?this._map.get(t):this._templateLoadTask&&this._templateLoaded===t?this._templateLoadTask.promise:this._fetchTemplate(t).promise}getLessonFiles(e){return this._getFilesFromFilesRefList(e.files)}getLessonSolution(e){return this._getFilesFromFilesRefList(e.solution)}_fetchTemplate(e){this._templateLoadTask?.cancel();const t=w(async s=>{const n=await fetch(`${this._basePathname}${e}`,{signal:s});if(!n.ok)throw new Error(`Failed to fetch: status ${n.status}`);const i=fe(await n.json());return this._map.set(e,i),s.throwIfAborted(),i});return this._templateLoadTask=t,this._templateLoaded=e,t}async _getFilesFromFilesRefList(e){if(e[1].length===0)return{};const t=e[0];return this._map.has(t)?this._map.get(t):this._fetchFiles(t)}async _fetchFiles(e){let t=2;for(;;){try{const s=await fetch(`${this._basePathname}${e}`);if(!s.ok)throw new Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);const n=fe(await s.json());return this._map.set(e,n),n}catch(s){if(t<=0)return console.error(`Failed to fetch ${e} after 3 attempts.`),console.error(s),{}}t-=1,await St(1e3)}}}function fe(r){const e={};if(typeof r!="object")return e;for(const t in r){const s=r[t];let n;typeof s=="object"?n=Uint8Array.from(atob(s.base64),i=>i.charCodeAt(0)):n=s,e[t]=n}return e}function It(r){return r.startsWith("template-")?"template":r.endsWith("files.json")?"files":"solution"}class pe{_config;constructor(e){this._config=xt(e)}get visible(){return this._config.visible}get fileTree(){return this._config.fileTree}}function xt(r){return r===!1?{visible:!1,fileTree:{visible:!1,allowEdits:!1}}:r===void 0||r===!0?{visible:!0,fileTree:{visible:!0,allowEdits:!1}}:typeof r.fileTree=="boolean"?{visible:!0,fileTree:{visible:r.fileTree,allowEdits:!1}}:typeof r.fileTree?.allowEdits=="boolean"||!r.fileTree?.allowEdits?{visible:!0,fileTree:{visible:!0,allowEdits:r.fileTree?.allowEdits?["**"]:!1}}:{visible:!0,fileTree:{visible:!0,allowEdits:Ot(r.fileTree.allowEdits)}}}function Ot(r){return Array.isArray(r)?r:[r]}class Dt{editorConfig=f(new pe);selectedFile=f();documents=vt({});files=he(this.documents,e=>Object.entries(e).map(([t,s])=>({path:t,type:s?.type||"file"})));currentDocument=he([this.documents,this.selectedFile],(e,t)=>{if(t)return e[t]});setEditorConfig(e){this.editorConfig.set(new pe(e))}setSelectedFile(e){this.selectedFile.set(e)}setDocuments(e){const t="file";if(Array.isArray(e))this.documents.set(Object.fromEntries(e[1].map(s=>[s,{value:"",type:t,loading:!0,filePath:s}])));else{const s=this.documents.value;this.documents.set(Object.fromEntries(Object.entries(e).map(([n,i])=>[n,{value:i,type:t,loading:!1,filePath:n,scroll:s?.[n]?.scroll}])))}}updateScrollPosition(e,t){const s=this.documents.get()[e];s&&this.documents.setKey(e,{...s,scroll:t})}addFileOrFolder(e){const t=this.files.get().find(s=>s.type==="folder"&&e.path.startsWith(s.path));t&&t.type==="folder"&&this.documents.setKey(t.path,void 0),this.documents.setKey(e.path,{filePath:e.path,type:e.type,value:"",loading:!1})}updateFile(e,t){const s=this.documents.get()[e];if(!s)return!1;const i=s.value!==t;return i&&this.documents.setKey(e,{...s,value:t}),i}onDocumentChanged(e,t){const s=this.currentDocument.subscribe(i=>{i?.filePath===e&&t(i)}),n=this.documents.subscribe(i=>{const o=i[e];o&&!o.loading&&queueMicrotask(()=>{t(o),n()})});return()=>{n(),s()}}}class Wt{_availablePreviews=new Map;_previewsLayout=[];previews=f([]);constructor(e){this._init(e)}async _init(e){(await e).on("port",(s,n,i)=>{let o=this._availablePreviews.get(s);o||(o=new de(s,i,n==="open"),this._availablePreviews.set(s,o)),o.ready=n==="open",o.origin=i,this._previewsLayout.length===0?this.previews.set([new W({},o)]):(this._previewsLayout=[...this._previewsLayout],this.previews.set(this._previewsLayout))})}setPreviews(e){if(e===!1){this.previews.set([]);return}const t=e===!0?[]:e??[],s=t.map(i=>{const o=W.parse(i);let a=this._availablePreviews.get(o.port);return a||(a=new de(o.port),this._availablePreviews.set(o.port,a)),new W(o,a)});let n=s.length!=this._previewsLayout.length;if(!n)for(let i=0;i<s.length&&(n=!W.equals(s[i],this._previewsLayout[i]),!n);i++);if(n)if(this._previewsLayout=s,t.length===0){const i=this._availablePreviews.values().next().value;this.previews.set(i?[i]:[])}else this.previews.set(this._previewsLayout)}}function Mt(){try{const r="SharedArrayBuffer"in globalThis,e=navigator.userAgent.includes("Chrome"),t=navigator.userAgent.includes("Firefox"),s=navigator.userAgent.includes("Safari");if(r&&(e||t))return!0;if(r&&s){const n=navigator.userAgent.match(/Version\/(\d+)\.(\d+) (?:Mobile\/.*?)?Safari/),i=n?Number(n?.[1]):0,o=n?Number(n?.[2]):0;return i>16||i===16&&o>=4}return!!localStorage.getItem("webcontainer_any_ua")}catch{return!1}}const T="\x1B[0m",P={reset:T,clear:"\x1B[g",red:r=>`\x1B[1;31m${r}${T}`,gray:r=>`\x1B[37m${r}${T}`,green:r=>`\x1B[1;32m${r}${T}`,magenta:r=>`\x1B[35m${r}${T}`};function M(r){r?.reset(),r?.write(P.clear)}async function Ut(r,e,t){const s=[];t?.allowRedirects||s.push("--no-redirects"),Array.isArray(t?.allowCommands)&&s.push("--allow-commands",t.allowCommands.join(","));const n=await r.spawn("/bin/jsh",["--osc",...s],{terminal:{cols:e.cols??80,rows:e.rows??15}}),i=n.input.getWriter(),o=n.output,a=Re();let l=!1;return o.pipeTo(new WritableStream({write(c){if(!l){const[,h]=c.match(/\x1b\]654;([^\x07]+)\x07/)||[];h==="interactive"&&(l=!0,a.resolve())}e.write(c)}})),e.onData(c=>{l&&i.write(c)}),await a.promise,n}class me{_config;constructor(e){const t=$t(e);this._config=t}get panels(){return this._config.panels}get activePanel(){return this._config.activePanel}get defaultOpen(){return this._config.defaultOpen}}const Nt={output:"Output",terminal:"Terminal"};let zt=0;class m{type;_options;static panelCount={output:0,terminal:0};static resetCount(){this.panelCount={output:0,terminal:0}}id;title;_terminal;_process;_data=[];_onData;constructor(e,t){this.type=e,this._options=t;let s=t?.title;if(!s){s=Nt[e];const n=m.panelCount[e];n>0&&(s+=` ${n}`),m.panelCount[e]++}this.title=s,this.id=t?.id??(e==="output"?"output":`${e}-${zt++}`)}get terminal(){return this._terminal}get process(){return this._process}get processOptions(){if(this.type!=="output")return{allowRedirects:this._options?.allowRedirects??!1,allowCommands:this._options?.allowCommands}}get cols(){return this._terminal?.cols}get rows(){return this._terminal?.rows}reset(){this._terminal?this._terminal.reset():this._data=[]}write(e){this._terminal?this._terminal.write(e):this._data.push({data:e,type:"echo"})}input(e){if(this.type!=="terminal")throw new Error("Cannot write data to output-only terminal");this._terminal?this._terminal.input(e):this._data.push({data:e,type:"input"})}onData(e){this._terminal?this._terminal.onData(e):this._onData=e}attachProcess(e){this._process=e,this.cols!=null&&this.rows!=null&&this._process.resize({cols:this.cols,rows:this.rows})}attachTerminal(e){for(const{type:t,data:s}of this._data)t==="echo"?e.write(s):e.input(s);this._data=[],this._terminal=e,this._onData&&e.onData(this._onData),this.cols!=null&&this.rows!=null&&this._process?.resize({cols:this.cols,rows:this.rows})}}function $t(r){let e=0;if(r===!1)return{panels:[],activePanel:e,defaultOpen:!1};if(m.resetCount(),r===void 0||r===!0)return{panels:[new m("output")],activePanel:e,defaultOpen:!1};const t=[],s={allowRedirects:r.allowRedirects,allowCommands:r.allowCommands};if(r.panels){if(r.panels==="output")t.push(new m("output"));else if(r.panels==="terminal")t.push(new m("terminal",s));else if(Array.isArray(r.panels))for(const n of r.panels){let i;typeof n=="string"?i=new m(n,s):Array.isArray(n)?i=new m(n[0],{title:n[1],...s}):i=new m(n.type,{id:n.id,title:n.title,allowRedirects:n.allowRedirects??r.allowRedirects,allowCommands:n.allowCommands??r.allowCommands}),t.push(i)}}return typeof r.activePanel=="number"&&(e=r.activePanel,e>=t.length&&(e=0)),{activePanel:e,panels:t,defaultOpen:r.open||!1}}class jt{_webcontainer;_useAuth;terminalConfig=f(new me);_output=void 0;_webcontainerLoaded=!1;constructor(e,t){this._webcontainer=e,this._useAuth=t,this._webcontainer.then(()=>{this._webcontainerLoaded=!0})}getOutputPanel(){return this._output}hasTerminalPanel(){return this.terminalConfig.get().panels.length>0}setTerminalConfiguration(e){const t=this.terminalConfig.get(),s=new me(e),n=new Map(t.panels.map(i=>[i.id,i]));for(const i of s.panels){const o=n.get(i.id);n.delete(i.id),o?.terminal&&i.attachTerminal(o.terminal),i.type==="output"&&(this._output=i),i.type==="terminal"&&!o&&this._bootWebContainer(i).then(async a=>{i.attachProcess(await Ut(a,i,i.processOptions))}).catch(()=>{})}for(const i of n.values())i.process?.kill();this.terminalConfig.set(s)}async attachTerminal(e,t){const s=this.terminalConfig.get().panels.find(n=>n.id===e);s&&s.attachTerminal(t)}onTerminalResize(e,t){for(const s of this.terminalConfig.get().panels)s.process?.resize({cols:e,rows:t})}async _bootWebContainer(e){Jt(e);const t=this._webcontainerLoaded;this._useAuth&&!t&&(e.write("Waiting for authentication to complete..."),await F.loggedIn(),M(e)),t||e.write("Booting WebContainer...");try{const s=await this._webcontainer;return t||M(e),s}catch(s){throw M(e),await kt(),e.write([P.red("Looks like your browser's configuration is blocking WebContainers."),"","Let's troubleshoot this!","","Read more at:","https://webcontainers.io/guides/browser-config",""].join(`
`)),s}}}function Jt(r){if(!Mt())throw r.write([P.red("Incompatible Web Browser"),"","WebContainers currently work in Chromium-based browsers, Firefox, and Safari 16.4. We're hoping to add support for more browsers as they implement the necessary Web Platform features.","","Read more about browser support:","https://webcontainers.io/guides/browser-support",""].join(`
`)),new Error("Incompatible Web Browser")}class Vt{_counts=new Map;increment(e){if(typeof e=="string"){const t=this._counts.get(e)??0;this._counts.set(e,t+1);return}e.forEach(t=>this.increment(t))}decrement(e){const t=this._counts.get(e)??0;return t===0?!0:(this._counts.set(e,t-1),t-1===0)}}function Bt(r,e){const t={},s=[];for(const n in r){const i=r[n],o=e[n];typeof o>"u"?s.push(n):i!==o&&(t[n]=o)}for(const n in e)n in r||(t[n]=e[n]);return{addedOrModified:t,removed:s}}function X(r){const e={};for(const t in r){const s=t.split("/").filter(i=>i);let n=e;for(let i=0;i<s.length;++i){const o=s[i];if(i===s.length-1)n[o]={file:{contents:r[t]}};else{let a=n[o];Ht(a),a||(a={directory:{}},n[o]=a),n=a.directory}}}return e}function Ht(r){if(r&&!("directory"in r))throw new Error("Expected directory node")}class qt{_webcontainer;_terminalStore;_editorStore;_stepController;_currentLoadTask=void 0;_currentProcessTask=void 0;_currentCommandProcess=void 0;_currentTemplate=void 0;_currentFiles=void 0;_currentRunCommands=void 0;_ignoreFileEvents=new Vt;_watcher;_watchContentFromWebContainer=!1;_readyToWatch=!1;_packageJsonDirty=!1;_commandsChanged=!1;_packageJsonContent="";_packageJsonPath="";constructor(e,t,s,n){this._webcontainer=e,this._terminalStore=t,this._editorStore=s,this._stepController=n}setWatchFromWebContainer(e){this._watchContentFromWebContainer=e,this._readyToWatch&&this._watchContentFromWebContainer?this._webcontainer.then(t=>this._setupWatcher(t)):this._watchContentFromWebContainer||this._stopWatcher()}setCommands(e){const t=new Y(e);this._changeDetection(e)&&(this._stepController.setFromCommands([...t]),this._currentRunCommands=t,this._commandsChanged=!0)}onTerminalResize(e,t){this._currentCommandProcess?.resize({cols:e,rows:t})}createFolder(e){const t=this._currentLoadTask?.promise;this._currentLoadTask=w(async s=>{await t;const n=await this._webcontainer;s.throwIfAborted(),this._ignoreFileEvents.increment(e),await n.fs.mkdir(e)},{ignoreCancel:!0})}updateFile(e,t){const s=this._currentLoadTask?.promise;this._currentLoadTask=w(async n=>{await s;const i=await this._webcontainer;n.throwIfAborted(),this._ignoreFileEvents.increment(e),await i.fs.writeFile(e,t),this._updateCurrentFiles({[e]:t})},{ignoreCancel:!0})}updateFiles(e){const t=this._currentLoadTask?.promise;this._currentLoadTask=w(async s=>{await t;const n=await this._webcontainer;s.throwIfAborted(),this._ignoreFileEvents.increment(Object.keys(e)),await n.mount(X(e)),this._updateCurrentFiles(e)},{ignoreCancel:!0})}async fileExists(e){return this._fsExists(e,"file")}async folderExists(e){return this._fsExists(e,"folder")}async _fsExists(e,t){if(this._currentFiles?.[e]||this._currentTemplate?.[e])return!0;const s=this._currentLoadTask?.promise;return new Promise(n=>{this._currentLoadTask=w(async()=>{await s;const i=await this._webcontainer;try{t==="file"?await i.fs.readFile(e):await i.fs.readdir(e),n(!0)}catch{n(!1)}},{ignoreCancel:!0})})}prepareFiles({files:e,template:t,signal:s,abortPreviousLoad:n=!0}){const i=this._currentLoadTask?.promise;return n&&this._currentLoadTask?.cancel(),this._currentLoadTask=w(async o=>{await i,this._readyToWatch=!1,this._stopWatcher();const a=await this._webcontainer;o.throwIfAborted(),[t,e]=await Promise.all([t,e]),o.throwIfAborted(),this._currentFiles||this._currentTemplate?await Gt(a,{...this._currentTemplate,...this._currentFiles},{...t,...e}):await a.mount(X({...t,...e})),this._currentTemplate={...t},this._currentFiles={...e},this._updateDirtyState({...t,...e})},{ignoreCancel:!0,signal:s}),this._currentLoadTask.promise}runCommands({abortPreviousRun:e=!0}={}){const t=this._currentProcessTask,s=this._currentLoadTask?.promise,n=this._currentRunCommands,i=this._commandsChanged;if(!n)throw new Error("setCommands should be called before runCommands");this._currentProcessTask=w(async o=>{if(await s,o.aborted&&e&&t?.cancel(),o.throwIfAborted(),!(this._packageJsonDirty||i)){if(t){const c=()=>t.cancel();return o.addEventListener("abort",c,{once:!0}),t.promise}return}this._commandsChanged=!1,e&&t?.cancel(),await t?.promise;const l=await this._webcontainer;return o.throwIfAborted(),this._runCommands(l,n,o)},{ignoreCancel:!0})}restartLastRunCommands(){if(!this._currentRunCommands||!this._currentProcessTask)return;const e=this._currentRunCommands,t=this._currentProcessTask.promise,s=this._currentLoadTask?.promise;this._currentProcessTask.cancel(),this._currentProcessTask=w(async n=>{await Promise.all([t,s]);const i=await this._webcontainer;return n.throwIfAborted(),this._runCommands(i,e,n)},{ignoreCancel:!0})}takeSnapshot(){const e={};for(const[t,s]of Object.entries(this._currentTemplate||{}))typeof s=="string"&&(e[t.slice(1)]=s);for(const[t,s]of Object.entries(this._currentFiles||{}))typeof s=="string"&&(e[t.slice(1)]=s);if(this._packageJsonContent){let t;try{t=JSON.parse(this._packageJsonContent)}catch{}if(t&&!t.stackblitz?.startCommand){const s=this._currentRunCommands?.mainCommand?.shellCommand,i=[...(this._currentRunCommands?.prepareCommands||[]).map(o=>o.shellCommand),s].filter(Boolean).join(" && ");e[this._packageJsonPath.slice(1)]=JSON.stringify({...t,stackblitz:{startCommand:i}},null,2)}}return{files:e}}async _runCommands(e,t,s){const n=this._terminalStore.getOutputPanel();M(n);const i=()=>this._currentCommandProcess?.kill();s.addEventListener("abort",i,{once:!0});let o=!0;try{const a=[...t];this._stepController.setFromCommands(a);let l=0;for(const[c,h]of a.entries()){const d=c===a.length-1&&!!t.mainCommand;if(!h.isRunnable()){this._stepController.updateStep(c,{title:h.title,status:"skipped"});continue}this._stepController.updateStep(c,{title:h.title,status:"running"}),l>0&&n?.write(`
`),l++,this._currentCommandProcess=await this._newProcess(e,n,h.shellCommand);try{s.throwIfAborted()}catch(L){throw this._stepController.skipRemaining(c),L}if(d&&(o=!1,this._setupWatcher(e),this._clearDirtyState()),await this._currentCommandProcess.exit!==0){this._stepController.updateStep(c,{title:h.title,status:"failed"}),this._stepController.skipRemaining(c+1),o=!1;break}else this._stepController.updateStep(c,{title:h.title,status:"completed"});try{s.throwIfAborted()}catch(L){throw this._stepController.skipRemaining(c+1),L}}o&&this._clearDirtyState(),this._setupWatcher(e)}finally{s.removeEventListener("abort",i)}}async _newProcess(e,t,s){const[n,...i]=s.split(" ");t?.write(`${P.magenta("❯")} ${P.green(n)} ${i.join(" ")}
`);const o=await e.spawn(n,i,{terminal:t?{cols:t.cols??80,rows:t.rows??15}:void 0});return o.output.pipeTo(new WritableStream({write:a=>t?.write(a)})),o}_updateDirtyState(e){for(const t in e)if(t.endsWith("/package.json")&&e[t]!=this._packageJsonContent){this._packageJsonContent=e[t],this._packageJsonPath=t,this._packageJsonDirty=!0;return}}_updateCurrentFiles(e){if(this._currentFiles)for(const t in e)this._currentFiles[t]=e[t];else this._currentFiles={...e};this._updateDirtyState(e)}_stopWatcher(){this._watcher&&(this._watcher.close(),this._watcher=void 0)}_setupWatcher(e){if(this._readyToWatch=!0,this._watcher||!this._watchContentFromWebContainer)return;const t=new Map;let s;const n=()=>{const o=[...t.entries()];t.clear(),Promise.all(o.map(async([a,l])=>{const c=await e.fs.readFile(a,l);return[a,c]})).then(a=>{for(const[l,c]of a)this._editorStore.updateFile(l,c)})},i=(o,a)=>{t.set(o,a),clearTimeout(s),s=setTimeout(n,100)};this._watcher=e.fs.watch(".",{recursive:!0},(o,a)=>{const l=`/${a}`;if(!this._ignoreFileEvents.decrement(l)||o!=="change")return;const c=this._editorStore.documents.get()[l];c&&i(l,typeof c.value=="string"?"utf-8":null)})}_clearDirtyState(){this._packageJsonDirty=!1}_changeDetection(e){if(this._packageJsonDirty||!this._currentRunCommands)return!0;const t=Q(this._currentRunCommands),s=Q(e);if(t.length!==s.length)return!0;for(let n=0;n<t.length;++n)if(!k.equals(t[n],s[n]))return!0;return!1}}function Q(r){return r instanceof Y?[...r].filter(e=>e.isRunnable()):Q(new Y(r))}async function Gt(r,e,t){const{removed:s,addedOrModified:n}=Bt(e,t);for(const i of s)await r.fs.rm(i,{force:!0});await r.mount(X(n))}class Yt{_webcontainer;_runner;_previewsStore;_editorStore;_terminalStore;_stepController=new Lt;_lessonFilesFetcher;_lessonTask;_lesson;_ref=f(1);_themeRef=f(1);_lessonFiles;_lessonSolution;_lessonTemplate;lessonFullyLoaded=f(!1);constructor({useAuth:e,webcontainer:t,basePathname:s}){this._webcontainer=t,this._editorStore=new Dt,this._lessonFilesFetcher=new At(s),this._previewsStore=new Wt(this._webcontainer),this._terminalStore=new jt(this._webcontainer,e),this._runner=new qt(this._webcontainer,this._terminalStore,this._editorStore,this._stepController)}setLesson(e,t={}){e!==this._lesson&&(this._lessonTask?.cancel(),this._ref.set(1+(this._ref.value||0)),this._lesson=e,this.lessonFullyLoaded.set(!1),this._previewsStore.setPreviews(e.data.previews??!0),this._terminalStore.setTerminalConfiguration(e.data.terminal),this._editorStore.setEditorConfig(e.data.editor),this._runner.setCommands(e.data),this._editorStore.setDocuments(e.files),!t.ssr&&(this._runner.setWatchFromWebContainer(e.data.filesystem?.watch??!1),this._lessonTask=w(async s=>{const n=this._lessonFilesFetcher.getLessonTemplate(e),i=this._lessonFilesFetcher.getLessonFiles(e),o=this._runner.prepareFiles({template:n,files:i,signal:s});this._runner.runCommands();const[a,l,c]=await Promise.all([n,this._lessonFilesFetcher.getLessonSolution(e),i]);s.throwIfAborted(),this._lessonTemplate=a,this._lessonFiles=c,this._lessonSolution=l,this._editorStore.setDocuments(c),e.data.focus===void 0?this._editorStore.setSelectedFile(void 0):c[e.data.focus]!==void 0&&this._editorStore.setSelectedFile(e.data.focus),await o,s.throwIfAborted(),this.lessonFullyLoaded.set(!0)},{ignoreCancel:!0})))}get previews(){return this._previewsStore.previews}get terminalConfig(){return this._terminalStore.terminalConfig}get editorConfig(){return this._editorStore.editorConfig}get currentDocument(){return this._editorStore.currentDocument}get bootStatus(){return Tt}get documents(){return this._editorStore.documents}get files(){return this._editorStore.files}get selectedFile(){return this._editorStore.selectedFile}get lesson(){return this._lesson}get ref(){return this._ref}get themeRef(){return this._themeRef}get steps(){return this._stepController.steps}hasFileTree(){return this._lesson?this.editorConfig.get().fileTree.visible:!1}hasEditor(){return this._lesson?this.editorConfig.get().visible:!1}hasPreviews(){if(!this._lesson)return!1;const{previews:e}=this._lesson.data;return e!==!1}hasTerminalPanel(){return this._terminalStore.hasTerminalPanel()}hasSolution(){return!!this._lesson&&Object.keys(this._lesson.solution[1]).length>=1}unblockBoot(){Ft()}reset(){!this.lessonFullyLoaded.value||!this._lessonFiles||(this._editorStore.setDocuments(this._lessonFiles),this._runner.updateFiles(this._lessonFiles))}solve(){if(!this.lessonFullyLoaded.value||!this._lessonSolution)return;const t={...this._lessonFiles,...this._lessonSolution};this._editorStore.setDocuments(t),this._runner.updateFiles(t)}setSelectedFile(e){this._editorStore.setSelectedFile(e)}async addFile(e){if(this.setSelectedFile(e),!this._editorStore.files.get().find(t=>t.path===e)){if(await this._runner.fileExists(e))throw new Error("FILE_EXISTS");this._editorStore.addFileOrFolder({path:e,type:"file"}),this._runner.updateFile(e,"")}}async addFolder(e){if(!this._editorStore.files.get().some(t=>t.path.startsWith(e))){if(await this._runner.folderExists(e))throw new Error("FOLDER_EXISTS");this._editorStore.addFileOrFolder({path:e,type:"folder"}),this._runner.createFolder(e)}}updateFile(e,t){this._editorStore.updateFile(e,t)&&this._runner.updateFile(e,t)}setCurrentDocumentContent(e){const t=this.currentDocument.get()?.filePath;t&&this.updateFile(t,e)}setCurrentDocumentScrollPosition(e){const t=this.currentDocument.get();if(!t)return;const{filePath:s}=t;this._editorStore.updateScrollPosition(s,e)}attachTerminal(e,t){this._terminalStore.attachTerminal(e,t)}onTerminalResize(e,t){e&&t&&(this._terminalStore.onTerminalResize(e,t),this._runner.onTerminalResize(e,t))}onDocumentChanged(e,t){return this._editorStore.onDocumentChanged(e,t)}takeSnapshot(){return this._runner.takeSnapshot()}}function Xt(r,...e){let t=r||"/";for(const s of e){if(s.length===0)continue;const n=t.endsWith("/"),i=s.startsWith("/");n&&i?t+=s.slice(1):n||i?t+=s:t+=`/${s}`}return t}let Z=new Promise(()=>{});Z=Promise.resolve(null).then(()=>Et({workdirName:"tutorial"})),Z.then(()=>{Qt.loaded=!0});const er=new Yt({webcontainer:Z,useAuth:Le,basePathname:Xt("/","/")});async function tr(){F.startAuthFlow({popup:!0}),await F.loggedIn()}function rr(){F.logout({ignoreRevokeError:!0})}const Qt={useAuth:Le,loggedIn:()=>F.loggedIn(),loaded:!1};export{rr as a,tr as l,er as t};
